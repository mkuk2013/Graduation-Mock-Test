<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBA Graduation Past Paper Test</title>
    <!-- Corrected CDN links -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- Base Variables & Reset --- */
        :root {
            /* New Vibrant & Professional Palette */
            --primary-color: #5A67D8; /* Indigo Blue */
            --primary-dark: #434190;
            --secondary-color: #48BB78; /* Emerald Green */
            --secondary-dark: #38A169;
            --accent-color: #F6AD55; /* Warm Orange */
            --accent-dark: #ED8936;
            --warning-color: #ECC94B; /* Yellow */
            --danger-color: #F56565; /* Red */

            --text-color: #2D3748; /* Dark Grey */
            --light-text-color: #718096; /* Muted Grey */
            --bg-color: #F7FAFC; /* Light Grey-Blue background */
            --card-bg: #FFFFFF; /* Pure White card background */
            --border-color: #E2E8F0; /* Light border */
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Enhanced, softer shadow */
            --border-radius: 16px; /* More rounded */
            --input-bg: #FFFFFF;
            --hover-bg-light: rgba(0, 0, 0, 0.05);

            /* Calculator/Scratchpad - Adjusted for new palette */
            --calc-bg: #2D3748; /* Dark Grey */
            --calc-border: #1A202C;
            --calc-btn-bg: #4A5568; /* Medium Grey */
            --calc-btn-hover: #606F82;
            --calc-btn-operator-bg: var(--accent-color); /* Orange */
            --calc-btn-operator-hover: var(--accent-dark);
            --calc-btn-clear-bg: #2C5282; /* Darker Blue */
            --calc-btn-clear-hover: #2B6CB0;
            --calc-display-bg: #1A202C; /* Very Dark Grey */
            --calc-display-text: white;
            --scratchpad-bg: #FFFFFF;
            --scratchpad-border: #E2E8F0;
        }

        /* Dark Mode Variables - New Palette */
        body.dark-mode {
            --primary-color: #7F9CF5; /* Lighter Indigo */
            --primary-dark: #667EEA;
            --secondary-color: #68D391; /* Lighter Emerald */
            --secondary-dark: #48BB78;
            --accent-color: #FBD38D; /* Lighter Orange */
            --accent-dark: #F6AD55;
            --warning-color: #F6E05E; /* Lighter Yellow */
            --danger-color: #FC8181; /* Lighter Red */

            --text-color: #E2E8F0; /* Light Grey */
            --light-text-color: #A0AEC0; /* Muted light grey */
            --bg-color: #1A202C; /* Very Dark Blue-Grey background */
            --card-bg: #2D3748; /* Dark Blue-Grey card background */
            --border-color: #4A5568; /* Darker border */
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.4); /* More prominent shadow */
            --input-bg: #4A5568;
            --hover-bg-light: rgba(255, 255, 255, 0.1);

            /* Calculator/Scratchpad Dark Mode - Match overall dark theme, keep calc distinct */
            --calc-bg: #2D3748;
            --calc-border: #1A202C;
            --calc-btn-bg: #4A5568;
            --calc-btn-hover: #606F82;
            --calc-btn-operator-bg: var(--accent-color);
            --calc-btn-operator-hover: var(--accent-dark);
            --calc-btn-clear-bg: #2C5282;
            --calc-btn-clear-hover: #2B6CB0;
            --calc-display-bg: #1A202C;
            --calc-display-text: white;
            --scratchpad-bg: #2D3748;
            --scratchpad-border: #4A5568;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
            font-size: 16px;
        }

        /* --- Global Header & Footer --- */
        .page-header {
            width: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 40px;
            text-align: center;
            font-weight: 700;
            font-size: 1.4em;
            box-shadow: var(--shadow);
            flex-shrink: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .page-header h1 {
            font-size: 1.4em;
            margin: 0;
            flex-grow: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .mode-toggle {
            cursor: pointer;
            font-size: 1.7em;
            color: white;
            padding: 10px;
            border-radius: 50%;
            transition: background-color 0.3s, transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mode-toggle:hover {
            background-color: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }
        .mode-toggle i {
            pointer-events: none;
        }
        .page-footer {
            font-size: 0.9em;
            padding: 15px 20px;
            margin-top: auto;
            background-color: var(--primary-dark);
            color: white;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.15);
            text-align: center;
        }
        .page-footer a {
            color: inherit;
            text-decoration: none;
            font-weight: 500;
        }
        .page-footer a:hover {
            text-decoration: underline;
        }

        /* --- Main Container --- */
        .container {
            width: 100%;
            max-width: 1100px; /* Slightly wider */
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin: 30px auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color); /* Subtle border */
        }

        /* --- Common Screen Styling --- */
        .screen {
            padding: 50px; /* More padding */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .screen h2 {
            margin-bottom: 30px;
            font-size: 2.5em;
            color: var(--primary-color);
            font-weight: 800;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.05);
        }
        .screen p {
            font-size: 1.15em;
            color: var(--light-text-color);
            margin-bottom: 35px;
            line-height: 1.7;
            max-width: 700px;
        }

        /* --- Password Screen --- */
        #password-screen .input-group {
            position: relative;
            margin-bottom: 30px;
            width: 90%;
            max-width: 450px;
        }
        #password-input {
            width: 100%;
            padding: 16px 50px 16px 25px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1.1em;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: border-color 0.3s, background-color 0.3s, box-shadow 0.3s;
        }
        #password-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 5px rgba(90, 103, 216, 0.3); /* Primary color based shadow */
        }
        .toggle-password {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--light-text-color);
            font-size: 1.2em;
            transition: color 0.2s;
        }
        .toggle-password:hover {
            color: var(--text-color);
        }

        /* --- Instructions Screen --- */
        #instructions-screen {
            text-align: left;
        }
        #instructions-screen ul {
            list-style: none; /* Remove default bullets */
            margin-left: 0;
            padding-left: 0;
            margin-bottom: 40px;
            color: var(--text-color);
            max-width: 800px;
        }
        #instructions-screen ul li {
            display: flex; /* Use flexbox for alignment */
            align-items: flex-start; /* Align items to the start of the cross axis (top for row direction) */
            margin-bottom: 15px;
            font-size: 1.1em;
            line-height: 1.6;
        }
        #instructions-screen ul li::before {
            content: '\f058'; /* FontAwesome check-circle icon */
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            margin-right: 10px; /* Space between icon and text */
            color: var(--secondary-color); /* Green checkmark */
            font-size: 1.2em;
            flex-shrink: 0; /* Prevent icon from shrinking */
            display: inline-flex; /* Use inline-flex for pseudo-element to center content */
            justify-content: center;
            align-items: center;
            /* Removed fixed width and height */
            /* Added padding for visual spacing around the icon */
            padding-right: 5px;
            box-sizing: content-box;
        }
        #instructions-screen ul li span {
            flex-grow: 1; /* Allow the text content to grow and wrap */
        }
        #instructions-screen .btn {
            margin-top: 20px;
        }

        /* --- Test Screen Layout --- */
        #test-screen {
            padding: 0;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background-color: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 20px;
        }
        #question-counter, #timer {
            font-weight: 700;
            font-size: 1.2em;
            background: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 12px 22px;
            border-radius: 30px;
            min-width: 160px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: background-color 0.3s;
        }
        #timer.time-low {
            background: linear-gradient(45deg, var(--danger-color), #D64545);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: var(--border-color);
            height: 12px;
            border-radius: 6px;
            margin-top: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.08);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--secondary-color), var(--secondary-dark));
            border-radius: 6px;
            transition: width 0.5s ease-out;
        }

        .test-body {
            padding: 40px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        #question-container {
            font-size: 1.5em;
            margin-bottom: 35px;
            line-height: 1.7;
            font-weight: 600;
            color: var(--text-color);
        }
        .reading-passage {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
        }
        .reading-passage h3 {
            color: var(--primary-color);
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .reading-passage p {
            font-size: 1em;
            line-height: 1.8;
            color: var(--light-text-color);
            margin-bottom: 0; /* Override default p margin */
        }
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .option {
            padding: 18px 25px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s, transform 0.1s, box-shadow 0.2s;
            font-size: 1.15em;
            text-align: left;
            background-color: var(--card-bg);
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .option::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--light-text-color);
            border-radius: 50%;
            background-color: var(--card-bg);
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .option:hover {
            background-color: var(--hover-bg-light);
            border-color: var(--primary-color);
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }
        .option.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .option.selected::before {
            background-color: white;
            border-color: white;
            box-shadow: 0 0 0 4px var(--primary-color);
        }
        body.dark-mode .option.selected {
            color: var(--card-bg);
        }
        body.dark-mode .option.selected::before {
            box-shadow: 0 0 0 4px var(--primary-color);
        }

        .test-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            border-top: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 25px;
            background-color: var(--bg-color);
        }
        .test-footer .left-controls, .test-footer .right-controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        /* Flag Button - Updated styling */
        .btn-flag {
            background-color: var(--card-bg);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 12px 20px;
            font-size: 1em;
            box-shadow: none;
            transition: background-color 0.2s, color 0.2s, transform 0.2s, box-shadow 0.2s;
        }
        .btn-flag:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        .btn-flag.flagged {
            background-color: var(--warning-color);
            color: var(--text-color);
            border-color: var(--warning-color);
            box-shadow: 0 2px 8px rgba(255,193,7,0.4);
        }
        body.dark-mode .btn-flag.flagged {
            color: #333;
        }

        /* Submit Button Style */
        .btn-submit {
            background: linear-gradient(45deg, var(--secondary-color), var(--secondary-dark));
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .btn-submit:hover {
            background: linear-gradient(45deg, var(--secondary-dark), #38A169);
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .btn-submit:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* --- Question Palette --- */
       #question-palette {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 15px;
            padding: 30px 40px;
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-color);
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }
        #question-palette::-webkit-scrollbar {
            height: 8px;
        }
        #question-palette::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 4px;
        }
        #question-palette::-webkit-scrollbar-track {
            background-color: var(--border-color);
        }

        .palette-btn {
            width: 55px;
            height: 55px;
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            background-color: var(--card-bg);
            border: 2px solid var(--border-color);
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s, border-color 0.2s, transform 0.1s, box-shadow 0.2s;
            color: var(--text-color);
            font-size: 1.1em;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .palette-btn:hover {
            background-color: var(--hover-bg-light);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        .palette-btn.current {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: scale(1.08);
        }
        .palette-btn.answered {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        .palette-btn.not-answered {
            background-color: var(--warning-color);
            color: var(--text-color);
            border-color: var(--warning-color);
        }
        body.dark-mode .palette-btn.not-answered {
            color: #333;
        }
        .palette-btn.flagged {
            position: relative;
            box-shadow: 0 0 0 4px var(--danger-color); /* Red border for flagged */
        }
        .palette-btn.flagged::after {
            content: '\f024'; /* Flag icon */
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 4px;
            right: 4px;
            font-size: 0.8em;
            color: var(--danger-color);
            background-color: var(--card-bg);
            border-radius: 50%;
            padding: 3px;
            line-height: 1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        body.dark-mode .palette-btn.flagged::after {
            background-color: var(--card-bg);
        }


        /* --- Result Screen --- */
        #result-screen {
            padding: 50px;
            text-align: center;
        }
        #result-summary {
            margin-bottom: 50px;
            padding: 40px;
            border-radius: var(--border-radius);
            background-color: var(--bg-color);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
            width: 100%; /* Added this line */
        }
        #result-summary h2 {
            margin-top: 0;
            color: var(--primary-color);
        }
        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--secondary-color), var(--secondary-dark));
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: auto;
            margin-bottom: 30px;
            font-weight: 700;
            box-shadow: var(--shadow);
        }
        .score-circle span:first-child {
            font-size: 4.5em;
            font-weight: 800;
            line-height: 1;
        }
        .score-circle span:last-child {
            font-size: 1.3em;
            margin-top: 5px;
        }
        .score-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }
        .score-details div {
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
        }
        .score-details p {
            margin: 0;
            font-size: 1.1em;
        }
        .score-details p:first-child {
            color: var(--light-text-color);
            font-weight: 500;
            margin-bottom: 8px;
        }
        .score-details p:last-child {
            font-weight: 700;
            font-size: 1.3em;
            color: var(--primary-color);
        }
        .score-details div:nth-child(3) p:last-child { color: var(--secondary-color); } /* Correct */
        .score-details div:nth-child(4) p:last-child { color: var(--danger-color); } /* Incorrect */


        .result-question {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            text-align: left;
            background-color: var(--card-bg);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .result-question p {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.2em;
            line-height: 1.6;
            color: var(--text-color);
        }
        .result-option {
            margin-bottom: 10px;
            font-size: 1.05em;
            color: var(--light-text-color); /* Default color for options */
            display: flex; /* Use flexbox for alignment */
            align-items: center; /* Vertically center items */
            gap: 10px; /* Space between icon and text */
        }
        .result-option::before {
            content: '';
            display: inline-block; /* Make it take space in flex layout */
            width: 20px; /* Fixed width for consistent icon alignment */
            height: 20px; /* Fixed height for consistent icon alignment */
            border-radius: 50%; /* For the default dot */
            background-color: var(--light-text-color); /* For the default dot */
            flex-shrink: 0; /* Prevent icon from shrinking */
            text-align: center; /* Center Font Awesome icons within its box */
            line-height: 20px; /* Vertically center Font Awesome icons */
            font-size: 1.1em; /* Adjust font size for icons */
        }
        /* Correct option styling */
        .result-option.correct {
            color: var(--secondary-color); /* Green text for correct options */
            font-weight: 700;
        }
        .result-option.correct::before {
            content: '\f058'; /* Check circle */
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            background: none; /* Remove background circle */
            color: var(--secondary-color); /* Ensure green color */
        }
        /* Incorrect option styling (user's selected incorrect answer) */
        .result-option.incorrect.user-answer {
            color: var(--danger-color); /* Red text for incorrect options */
            font-weight: 700;
        }
        .result-option.incorrect.user-answer::before {
            content: '\f057'; /* Times circle */
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            background: none;
            color: var(--danger-color); /* Ensure red color */
        }
        /* User's selected correct answer (will also have .correct class) */
        .result-option.user-answer.correct::before {
            content: '\f058'; /* Check circle */
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            background: none;
            color: var(--secondary-color); /* Ensure green color */
        }
        .not-attempted-text {
            color: var(--light-text-color);
            font-style: italic;
            margin-left: 30px;
            margin-top: 15px;
            font-size: 0.95em;
        }

        /* --- Buttons --- */
        .btn {
            padding: 16px 40px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 600;
            transition: all 0.3s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        }
        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, var(--primary-dark), #434190);
        }
        .btn-secondary {
            background-color: var(--light-text-color);
            color: white;
        }
        .btn-secondary:hover {
            background-color: #5A67D8; /* A darker shade of primary for secondary hover */
        }
        .btn-danger {
            background: linear-gradient(45deg, var(--danger-color), #D64545);
            color: white;
        }
        .btn-danger:hover {
            background: linear-gradient(45deg, #D64545, #C53030);
        }

        /* Result screen controls */
        #result-screen .controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 40px;
            padding: 0 20px;
        }

        /* --- Modals (Confirmation Popups) --- */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
            animation: fadeInOverlay 0.3s ease-out;
        }
        .modal.hidden {
            display: none !important;
        }
        .modal-content {
            background-color: var(--card-bg);
            padding: 45px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 550px;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            animation: slideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); /* Springy animation */
            border: 1px solid var(--border-color);
        }
        .modal-content h3 {
            margin-bottom: 28px;
            color: var(--primary-color);
            font-size: 2em;
            font-weight: 800;
        }
        .modal-content p {
            font-size: 1.15em;
            line-height: 1.6;
            color: var(--text-color);
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 35px;
        }
        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-100px) scale(0.8); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Review Summary Modal */
        #review-summary-modal .modal-content {
            max-width: 750px;
            text-align: left;
        }
        #review-summary-modal h3 {
            text-align: center;
        }
        #review-summary-modal .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        #review-summary-modal .summary-item {
            background-color: var(--bg-color);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        #review-summary-modal .summary-item strong {
            display: block;
            font-size: 1.8em;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-weight: 700;
        }
        #review-summary-modal .summary-item span {
            color: var(--light-text-color);
            font-size: 1em;
        }
        #review-summary-modal .summary-item.answered strong {
            color: var(--secondary-color);
        }
        #review-summary-modal .summary-item.not-answered strong {
            color: var(--warning-color);
        }
        #review-summary-modal .summary-item.flagged strong {
            color: var(--danger-color);
        }

        /* --- Utility Classes --- */
        .hidden {
            display: none !important;
        }
        .flex-center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- Loading Spinner --- */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.4em;
            backdrop-filter: blur(10px);
        }
        .spinner {
            border: 10px solid rgba(255,255,255,0.2);
            border-top: 10px solid var(--primary-color);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        }
        #loading-overlay p {
            color: white;
            font-weight: 600;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Floating Tools (Calculator & Scratchpad) --- */
        .floating-tool-trigger {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: background-color 0.3s, transform 0.3s;
            z-index: 999;
        }
        .floating-tool-trigger:hover {
            background: linear-gradient(45deg, var(--primary-dark), #434190);
            transform: scale(1.1);
        }
        .floating-tool-container {
            position: fixed;
            background-color: var(--calc-bg);
            border: 1px solid var(--calc-border);
            border-radius: 20px; /* Specific for tools */
            box-shadow: var(--shadow);
            z-index: 998;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 0;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            min-width: 320px; /* Ensure minimum size */
            min-height: 200px;
        }
        .floating-tool-container.hidden {
            display: none !important;
        }
        .floating-tool-header {
            background-color: var(--calc-display-bg);
            color: var(--calc-display-text);
            padding: 12px 20px;
            border-top-left-radius: 18px; /* Match container border-radius -2px */
            border-top-right-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1.2em;
            cursor: grab;
        }
        .floating-tool-header .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.3em;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.2s;
        }
        .floating-tool-header .close-btn:hover {
            transform: scale(1.3);
        }

        /* Calculator Specific Styles */
        #calculator-tool {
            width: 340px; /* Slightly wider */
            height: 520px; /* Slightly taller */
            resize: none;
        }

        #calculator {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        #calculator .display {
            background-color: var(--calc-display-bg);
            color: var(--calc-display-text);
            font-size: 3.8em; /* Larger font */
            text-align: right;
            padding: 25px;
            flex-shrink: 0;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
        }
        #calculator .display::-webkit-scrollbar {
            height: 8px;
        }
        #calculator .display::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 4px;
        }
        #calculator .display::-webkit-scrollbar-track {
            background-color: transparent;
        }

        #calculator .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 2px;
            flex-grow: 1;
            background-color: var(--calc-border);
            padding-top: 2px;
        }

        #calculator .button {
            background-color: var(--calc-btn-bg);
            color: var(--calc-display-text);
            border: none;
            font-size: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        #calculator .button:hover {
            background-color: var(--calc-btn-hover);
        }

        #calculator .button.operator {
            background-color: var(--calc-btn-operator-bg);
        }

        #calculator .button.operator:hover {
            background-color: var(--calc-btn-operator-hover);
        }

        #calculator .button.clear-btn,
        #calculator .button.plus-minus,
        #calculator .button.percentage {
            background-color: var(--calc-btn-clear-bg);
        }

        #calculator .button.clear-btn:hover,
        #calculator .button.plus-minus:hover,
        #calculator .button.percentage:hover {
            background-color: var(--calc-btn-clear-hover);
        }

        #calculator .button.zero {
            grid-column: span 2;
            border-bottom-left-radius: 18px;
        }
        #calculator .button:nth-last-child(1) {
            border-bottom-right-radius: 18px;
        }


        /* Scratchpad Specific Styles */
        #scratchpad-tool {
            width: 450px;
            height: 350px;
            resize: both;
            display: flex;
            flex-direction: column;
            border-radius: 20px;
            background-color: var(--scratchpad-bg);
            border: 1px solid var(--scratchpad-border);
        }
        #scratchpad-tool .floating-tool-header {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            border-bottom: 1px solid var(--primary-dark);
        }
        body.dark-mode #scratchpad-tool .floating-tool-header {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            border-bottom: 1px solid var(--primary-dark);
        }
        #scratchpad-textarea {
            width: 100%;
            flex-grow: 1;
            border: none;
            padding: 20px;
            font-size: 1.05em;
            font-family: 'Inter', sans-serif;
            resize: none;
            outline: none;
            background-color: var(--scratchpad-bg);
            color: var(--text-color);
            line-height: 1.7;
            tab-size: 4;
            -moz-tab-size: 4;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        #scratchpad-textarea::placeholder {
            color: var(--light-text-color);
        }

        /* --- Toast Notifications --- */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001; /* Above modals */
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        .toast {
            background-color: rgba(45, 55, 72, 0.95); /* Dark grey with transparency */
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-size: 0.95em;
            opacity: 0;
            transform: translateY(-20px);
            animation: toastIn 0.5s forwards, toastOut 0.5s forwards 2.5s;
            min-width: 250px;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toast.success {
            background-color: rgba(76, 175, 80, 0.95); /* Green */
        }
        .toast.error {
            background-color: rgba(244, 67, 54, 0.95); /* Red */
        }
        .toast.info {
            background-color: rgba(33, 150, 243, 0.95); /* Blue */
        }

        @keyframes toastIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes toastOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }


        /* Responsive Design */
        @media (max-width: 768px) {
            .page-header, .test-header, .test-footer {
                padding: 15px 25px;
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            .page-header h1 {
                font-size: 1.2em;
            }
            .mode-toggle {
                position: absolute;
                top: 10px;
                right: 10px;
                padding: 8px;
                font-size: 1.5em;
            }
            #question-counter, #timer {
                font-size: 1.1em;
                padding: 10px 18px;
                min-width: unset;
                width: 100%;
            }
            .container {
                margin: 20px auto;
                border-radius: 12px;
            }
            .screen {
                padding: 30px;
            }
            .screen h2 {
                font-size: 2em;
                margin-bottom: 25px;
            }
            .screen p {
                font-size: 1em;
            }
            /* Instructions screen specific adjustments for mobile */
            #instructions-screen ul {
                padding-left: 0; /* Ensure no extra padding pushes content */
                margin-left: 0;
            }
            #instructions-screen ul li {
                font-size: 1em; /* Adjust font size for readability */
                margin-bottom: 10px; /* Reduce space between list items */
                align-items: flex-start; /* Keep icon and text aligned at the top */
                line-height: 1.5; /* Adjust line height for better spacing */
            }
            #instructions-screen ul li::before {
                font-size: 1.1em; /* Adjust icon size */
                margin-right: 8px; /* Adjust space between icon and text */
                /* Removed fixed width and height */
                padding-right: 3px; /* Adjust padding for mobile */
            }
            #question-container {
                font-size: 1.3em;
                margin-bottom: 30px;
            }
            .option {
                padding: 15px 20px;
                font-size: 1.05em;
            }
            .option::before {
                width: 18px;
                height: 18px;
            }
            .btn {
                width: 100%;
                margin-bottom: 10px;
                padding: 14px 30px;
                font-size: 1em;
            }
            .test-footer .left-controls, .test-footer .right-controls {
                flex-direction: column;
                width: 100%;
                gap: 15px;
            }
            #question-palette {
                gap: 10px;
                padding: 20px 25px;
            }
            .palette-btn {
                width: 50px;
                height: 50px;
                font-size: 1em;
                border-radius: 10px;
            }
            .palette-btn.flagged::after {
                font-size: 0.7em;
                top: 2px;
                right: 2px;
            }
            #result-screen {
                padding: 30px;
            }
            #result-summary {
                padding: 25px;
            }
            .score-circle {
                width: 160px;
                height: 160px;
                margin-bottom: 25px;
            }
            .score-circle span:first-child {
                font-size: 3.5em;
            }
            .score-circle span:last-child {
                font-size: 1.1em;
            }
            .score-details {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .modal-content {
                padding: 35px 25px;
            }
            .modal-content h3 {
                font-size: 1.8em;
            }
            .modal-content p {
                font-size: 1.05em;
            }
            .modal-buttons {
                flex-direction: column;
                gap: 15px;
            }
            .floating-tool-trigger {
                width: 55px;
                height: 55px;
                font-size: 1.8em;
                bottom: 20px;
                right: 20px;
            }
            #calculator-tool, #scratchpad-tool {
                width: 90%;
                max-width: 340px;
                height: auto;
                max-height: 90vh;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
            #calculator .display {
                font-size: 3em;
                padding: 20px;
            }
            #calculator .button {
                font-size: 1.8em;
            }
        }

        @media (max-width: 480px) {
            .page-header {
                padding-top: 55px;
            }
            .screen {
                padding: 20px;
            }
            .test-body {
                padding: 20px;
            }
            .test-footer {
                padding: 20px;
            }
            #question-palette {
                padding: 15px 20px;
            }
            .palette-btn {
                width: 45px;
                height: 45px;
                font-size: 0.9em;
            }
        }

        /* Print specific styles */
        @media print {
            body > *:not(.container) {
                display: none !important;
            }
            .container {
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                max-width: none !important;
                border-radius: 0 !important;
                border: none !important;
            }
            #result-screen {
                padding: 20px !important; /* Reduce padding for print */
                text-align: left !important; /* Align text left for readability */
            }
            #result-summary {
                box-shadow: none !important;
                border: none !important;
                padding: 20px !important;
                background-color: white !important; /* Ensure white background for print */
            }
            .score-circle {
                box-shadow: none !important;
                background: none !important;
                color: var(--primary-color) !important; /* Keep score color consistent */
                border: 2px solid var(--primary-color);
            }
            .score-circle span:first-child {
                color: var(--primary-color) !important;
            }
            .score-details div {
                box-shadow: none !important;
                border: 1px solid var(--border-color) !important;
                background-color: white !important;
            }
            .controls {
                display: none !important; /* Hide controls in print */
            }
            #answer-review-container {
                display: block !important; /* Ensure review answers are visible */
                width: 100% !important;
                margin-top: 0 !important;
            }
            .result-question {
                box-shadow: none !important;
                border: 1px solid var(--border-color) !important;
                background-color: white !important;
                padding: 15px !important;
                margin-bottom: 15px !important;
            }
            .result-option {
                margin-bottom: 5px !important;
            }
            .not-attempted-text {
                margin-left: 0 !important;
            }
            /* Ensure dark mode styles don't interfere with print */
            body.dark-mode .result-option.correct {
                color: var(--secondary-color) !important;
            }
            body.dark-mode .result-option.incorrect.user-answer {
                color: var(--danger-color) !important;
            }
            body.dark-mode .result-option.correct::before,
            body.dark-mode .result-option.incorrect.user-answer::before {
                color: inherit !important; /* Use inherited color for icons in print */
            }
            body.dark-mode #result-summary,
            body.dark-mode .score-details div,
            body.dark-mode .result-question {
                background-color: white !important;
                color: var(--text-color) !important; /* Ensure dark text on white background */
            }
            body.dark-mode .score-circle {
                color: var(--primary-color) !important;
            }
            body.dark-mode .score-circle span:first-child {
                color: var(--primary-color) !important;
            }
            body.dark-mode .score-details p:last-child {
                color: var(--primary-color) !important;
            }
            body.dark-mode .score-details div:nth-child(3) p:last-child { color: var(--secondary-color) !important; }
            body.dark-mode .score-details div:nth-child(4) p:last-child { color: var(--danger-color) !important; }
        }
    </style>
</head>
<body>
    <header class="page-header">
        <h1 style>21 JAN 2023 ORIGINAL PAPER (GRADUATION CATEGORY) - PAST PAPER</h1>
        <div class="mode-toggle" id="mode-toggle" title="Toggle Dark/Light Mode">
            <i class="fas fa-moon"></i>
        </div>
    </header>

    <main class="container">
        <section id="password-screen" class="screen">
            <h2>Enter Password to Start</h2>
            <p>Please enter the provided password to begin your mock test. This ensures the integrity of the test environment.</p>
            <div class="input-group">
                <input type="password" id="password-input" placeholder="Enter password">
                <span class="toggle-password" id="toggle-password">
                    <i class="fas fa-eye"></i>
                </span>
            </div>
            <button class="btn btn-primary" id="start-button">Start Test</button>
        </section>

        <section id="instructions-screen" class="screen hidden">
            <h2>Instructions</h2>
            <ul>
                <li><span>The test consists of <strong>100 Multiple Choice Questions (MCQs)</strong> across various sections.</span></li>
                <li><span>You have <strong>60 minutes (1 hour)</strong> to complete the test. The timer will start once you begin.</span></li>
                <li><span>Each question has only <strong>one correct answer</strong>.</span></li>
                <li><span>You can navigate between questions using the "Previous" and "Next" buttons, or by using the question palette at the bottom.</span></li>
                <li><span>You can "Flag" questions for review and come back to them later.</span></li>
                <li><span>Your progress (answered, not answered, flagged) will be visible in the question palette.</span></li>
                <li><span>A calculator and a scratchpad are available as floating tools for your convenience.</span></li>
                <li><span>Once you click "Submit Test," you will not be able to change your answers.</span></li>
                <li><span>Ensure you have a stable internet connection.</span></li>
                <li><span>Good luck!</span></li>
            </ul>
            <button class="btn btn-primary" id="begin-test-button">Begin Test</button>
        </section>

        <section id="test-screen" class="hidden">
            <div class="test-header">
                <div id="question-counter">Question: 1 / 100</div>
                <div id="timer">Time Left: 60:00</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
            </div>

            <div class="test-body">
                <div class="reading-passage hidden" id="reading-passage-container">
                    <h3>Reading Passage:</h3>
                    <p id="reading-passage-content"></p>
                </div>
                <p id="question-section" style="font-size: 1.1em; color: var(--primary-color); margin-bottom: 10px; font-weight: 600;"></p>
                <p id="question-container"></p>
                <div class="options-container" id="options-container">
                    </div>
            </div>

            <div class="test-footer">
                <div class="left-controls">
                    <!-- Flag for Review Button -->
                    <button class="btn btn-flag" id="flag-button"><i class="fas fa-flag"></i> Flag for Review</button>
                    <!-- Previous Button -->
                    <button class="btn btn-secondary hidden" id="prev-button"><i class="fas fa-arrow-left"></i> Previous</button>
                </div>
                <div class="right-controls">
                    <!-- Next Button -->
                    <button class="btn btn-primary" id="next-button">Next <i class="fas fa-arrow-right"></i></button>
                    <!-- Submit Button -->
                    <button class="btn btn-submit hidden" id="submit-test-button">Submit Test <i class="fas fa-check"></i></button>
                </div>
            </div>

            <div class="question-palette" id="question-palette">
                </div>
        </section>

        <section id="result-screen" class="screen hidden">
            <h2>Test Results</h2>
            <div id="result-summary">
                <div class="score-circle">
                    <span id="final-score">0</span>
                    <span>/ 100 Marks</span>
                </div>
                <div class="score-details">
                    <div>
                        <p>Total Questions</p>
                        <p id="total-questions-summary">100</p>
                    </div>
                    <div>
                        <p>Attempted Questions</p>
                        <p id="attempted-questions-summary">0</p>
                    </div>
                    <div>
                        <p>Correct Answers</p>
                        <p id="correct-answers-summary">0</p>
                    </div>
                    <div>
                        <p>Incorrect Answers</p>
                        <p id="incorrect-answers-summary">0</p>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-secondary" id="review-answers-button"><i class="fas fa-eye"></i> Review Answers</button>
                <button class="btn btn-primary" id="print-result-button"><i class="fas fa-print"></i> Print Result</button>
                <button class="btn btn-secondary" id="retake-test-button"><i class="fas fa-redo"></i> Retake Test</button>
            </div>

            <div id="answer-review-container" class="hidden" style="width: 100%; text-align: left; margin-top: 30px;">
                </div>
        </section>
    </main>

    <footer class="page-footer">
<p>&copy; 2025 Graduation Mock Test Series. All rights reserved. Crafted with dedication by <a href="https://mock-test-hub.netlify.app" target="_blank" rel="noopener noreferrer">Mock Test Hub</a></p>     </footer>

    <div id="confirm-submit-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Confirm Submission</h3>
            <p>Are you sure you want to submit the test? You will not be able to change your answers after submission.</p>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="confirm-submit-yes">Yes, Submit</button>
                <button class="btn btn-secondary" id="confirm-submit-no">No, Go Back</button>
            </div>
        </div>
    </div>

    <div id="review-summary-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Test Summary</h3>
            <div class="summary-grid">
                <div class="summary-item answered">
                    <strong id="summary-answered-count">0</strong>
                    <span>Answered</span>
                </div>
                <div class="summary-item not-answered">
                    <strong id="summary-not-answered-count">0</strong>
                    <span>Not Answered</span>
                </div>
                <div class="summary-item flagged">
                    <strong id="summary-flagged-count">0</strong>
                    <span>Flagged</span>
                </div>
            </div>
            <p>You have <span id="unanswered-flagged-message"></span></p>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="summary-continue-test">Continue Test</button>
                <button class="btn btn-danger" id="summary-submit-test">Submit Anyway</button>
            </div>
        </div>
    </div>

    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <p>Generating PDF...</p>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <div class="floating-tool-trigger" id="calculator-trigger" title="Open Calculator">
        <i class="fas fa-calculator"></i>
    </div>
    <div class="floating-tool-trigger" id="scratchpad-trigger" style="bottom: 95px;" title="Open Scratchpad">
        <i class="fas fa-pencil-alt"></i>
    </div>

    <div class="floating-tool-container hidden" id="calculator-tool">
        <div class="floating-tool-header">
            <span>Calculator</span>
            <button class="close-btn" data-tool="calculator"><i class="fas fa-times"></i></button>
        </div>
        <div id="calculator">
            <div class="display" id="calculator-display">0</div>
            <div class="buttons">
                <button class="button clear-btn">AC</button>
                <button class="button plus-minus">±</button>
                <button class="button percentage">%</button>
                <button class="button operator" data-operator="/">÷</button>
                <button class="button">7</button>
                <button class="button">8</button>
                <button class="button">9</button>
                <button class="button operator" data-operator="*">×</button>
                <button class="button">4</button>
                <button class="button">5</button>
                <button class="button">6</button>
                <button class="button operator" data-operator="-">-</button>
                <button class="button">1</button>
                <button class="button">2</button>
                <button class="button">3</button>
                <button class="button operator" data-operator="+">+</button>
                <button class="button zero">0</button>
                <button class="button decimal">.</button>
                <button class="button operator equal" data-operator="=">=</button>
            </div>
        </div>
    </div>

    <div class="floating-tool-container hidden" id="scratchpad-tool">
        <div class="floating-tool-header">
            <span>Scratchpad</span>
            <button class="close-btn" data-tool="scratchpad"><i class="fas fa-times"></i></button>
        </div>
        <textarea id="scratchpad-textarea" placeholder="Write your notes here..."></textarea>
    </div>

    <script>
        const PASSWORD = "ibacompletemocktest"; // Simple password for demonstration

    const quizData = [
      // English - Reading Comprehension (10 Questions) for Q1-Q10
      {
        question: "The phrase <strong>'Beauty is but skin deep'</strong> is a",
        section: "English - Reading Comprehension",
        options: ["Phrase", "Idiom", "Proverb", "Metaphor"],
        correctAnswer: 2
      },
      {
        question: "In the passage, the words <strong>\"the summer rain\"</strong> are used as a",
        section: "English - Reading Comprehension",
        options: ["metaphor", "comparison", "phrase", "clause"],
        correctAnswer: 0
      },
      {
        question: "The underlined word <u>\"indelible\"</u> means",
        section: "English - Reading Comprehension",
        options: ["Permanent", "matchless", "irreplaceable", "crucial"],
        correctAnswer: 0
      },
      {
        question: "The words <u>\"professions and actions\"</u> are",
        section: "English - Reading Comprehension",
        options: ["synonyms of each other in meanings", "antonyms of each other in meanings", "a group of related words", "a group of unrelated words"],
        correctAnswer: 0
      },
      {
        question: "The underlined word <u>\"volatile\"</u> means",
        section: "English - Reading Comprehension",
        options: ["unstable", "disinterested and lazy", "cold and partial", "easily changeable"],
        correctAnswer: 3
      },
      {
        question: "The underlined phrase <u>\"by virtue of\"</u> means",
        section: "English - Reading Comprehension",
        options: ["by means of", "in likeness of something", "in case of", "in view of prima facie"],
        correctAnswer: 0
      },
      {
        question: "The underlined phrase <u>\"for quite some time\"</u> means",
        section: "English - Reading Comprehension",
        options: ["time immortal", "in course of time", "from time to time", "for a long duration"],
        correctAnswer: 3
      },
      {
        question: "The most important word used in the <strong>second paragraph</strong> is",
        section: "English - Reading Comprehension",
        options: ["Character", "achievements", "Hereafter", "souls"],
        correctAnswer: 0
      },
      {
        question: "The underlined phrase <u>\"a short sojourn\"</u> means",
        section: "English - Reading Comprehension",
        options: ["a break-journey", "a temporary stay", "a short vacation", "a short overtime"],
        correctAnswer: 1
      },
      {
        question: "The passage has been composed in a/an <strong>______</strong> tone.",
        section: "English - Reading Comprehension",
        options: ["knowledgeable", "accomplished", "intellectual", "educational"],
        correctAnswer: 3
      },
      // English - Meanings of underlined words (synonyms and antonyms) (10 Questions) for Q11-Q20
      {
        question: "<u>Functional</u> Language is used for making plans. (Find the synonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["practical and useful", "having a special purpose", "utilitarian", "possible and important"],
        correctAnswer: 0
      },
      {
        question: "Always <u>keep</u> my mobile phone on the top shelf. (Find the synonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["hold up", "remain in a position", "put or place", "to be safe and secure"],
        correctAnswer: 2
      },
      {
        question: "The mouse is under the <u>log</u> in the corner. (Find the synonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["timber", "plank", "wood used for the fire", "a thick piece of wood that is cut from a tree"],
        correctAnswer: 3
      },
      {
        question: "Many minerals were <u>found</u> from under the surface of the earth. (Find the synonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["extracted or obtained", "located", "traced", "discovered"],
        correctAnswer: 0
      },
      {
        question: "<u>Exchange</u> your notebooks and read each other's work. (Find the synonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["give and take", "change", "to give something and get something different instead", "to give something and get nothing in return"],
        correctAnswer: 2
      },
      {
        question: "Helen Keller was a woman of great <u>learning</u>. (Find the antonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["illiteracy", "ignorance", "secrecy", "darkness"],
        correctAnswer: 1
      },
      {
        question: "Most motorcyclists are very careful, and drive <u>slow</u>. (Find the antonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["fast", "hastily", "Quickly", "speedy"],
        correctAnswer: 0
      },
      {
        question: "We can <u>prevent</u> deaths and injuries on the road. (Find the antonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["make", "happen", "cause", "neglecting"],
        correctAnswer: 2
      },
      {
        question: "Besides this, other <u>safety</u> rules can also be taught. (Find the antonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["separating", "dangerous", "safe and easy", "Omitting"],
        correctAnswer: 1
      },
      {
        question: "Some road conditions are <u>dangerous</u>. (Find the antonym)",
        section: "English - Meanings of underlined words (synonyms and antonyms)",
        options: ["wonderful", "safe", "enjoyable", "funny"],
        correctAnswer: 1
      },
      // Error Detection (5 Questions) for Q21-Q25
      {
        question: "Find the error: <strong>(A)</strong>That's <strong>(B)</strong>real a <strong>(C)</strong>wonderful <strong>(D)</strong>question.",
        section: "Error Detection",
        options: ["A", "B", "C", "D"],
        correctAnswer: 1
      },
      {
        question: "Find the error: <strong>(A)</strong>Nurses <strong>(B)</strong>look after the patients <strong>(C)</strong>with love and <strong>(D)</strong>carefully.",
        section: "Error Detection",
        options: ["A", "B", "C", "D"],
        correctAnswer: 3
      },
      {
        question: "Find the error: <strong>(A)</strong>Myths are <strong>(B)</strong>stories that <strong>(C)</strong>many people <strong>(D)</strong>misbelieve.",
        section: "Error Detection",
        options: ["A", "B", "C", "D"],
        correctAnswer: 3
      },
      {
        question: "Find the error: <strong>(A)</strong>Animal science <strong>(B)</strong>involves knowledge of <strong>(C)</strong>farm machines and <strong>(D)</strong>equipments.",
        section: "Error Detection",
        options: ["A", "B", "C", "D"],
        correctAnswer: 3
      },
      {
        question: "Find the error: <strong>(A)</strong>They said <strong>(B)</strong>that they <strong>(C)</strong>are going <strong>(D)</strong>to the cinema.",
        section: "Error Detection",
        options: ["A", "B", "C", "D"],
        correctAnswer: 2
      },
      // Preposition (5 Questions) for Q26-Q30
      {
        question: "I work <strong>______</strong> a factory.",
        section: "Preposition",
        options: ["at", "in", "for", "with"],
        correctAnswer: 1
      },
      {
        question: "I have to finish my report <strong>______</strong> tonight.",
        section: "Preposition",
        options: ["in", "from", "for", "by"],
        correctAnswer: 3
      },
      {
        question: "I can meet you today <strong>______</strong> noon.",
        section: "Preposition",
        options: ["at", "to", "during", "by"],
        correctAnswer: 0
      },
      {
        question: "He had to go and invite people <strong>______</strong> the wedding.",
        section: "Preposition",
        options: ["to", "for", "during", "at"],
        correctAnswer: 1
      },
      {
        question: "Last night my mother told me that we had been invited <strong>______</strong> the wedding.",
        section: "Preposition",
        options: ["for", "to", "in", "about"],
        correctAnswer: 1
      },
      // Sentence Structure (5 Questions) for Q31-Q35
      {
        question: "Will you be able to come over <strong>_______</strong>?",
        section: "Sentence Structure",
        options: ["during year", "before year", "next year", "in year"],
        correctAnswer: 2
      },
      {
        question: "His mother told him <strong>______</strong>.",
        section: "Sentence Structure",
        options: ["be afraid of Allah", "to be feared of Allah", "to get afraid of Allah", "to fear Allah"],
        correctAnswer: 3
      },
      {
        question: "The people of Pakistan have received a mate funeral <strong>______</strong>.",
        section: "Sentence Structure",
        options: ["B. few common citizens", "the few common citizens", "B. some few citizens", "few citizens"],
        correctAnswer: 3
      },
      {
        question: "The teacher said to me that <strong>______</strong>.",
        section: "Sentence Structure",
        options: ["I should work harder", "I will work harder", "I would work harder", "I could work harder"],
        correctAnswer: 2
      },
      {
        question: "I feel tired, and <strong>______</strong>.",
        section: "Sentence Structure",
        options: ["So am I", "So do I", "So do", "I so feel"],
        correctAnswer: 1
      },
      // Correct Spelling (5 Questions) for Q36-Q40
      {
        question: "Choose the correct spelling:",
        section: "Correct Spelling",
        options: ["hamlit", "hulmet", "hemlit", "helmet"],
        correctAnswer: 3
      },
      {
        question: "Choose the correct spelling:",
        section: "Correct Spelling",
        options: ["pedestrains", "pedestrians", "predistrians", "pedestirians"],
        correctAnswer: 1
      },
      {
        question: "Choose the correct spelling:",
        section: "Correct Spelling",
        options: ["mechanical", "mechanial", "mecanical", "machance"],
        correctAnswer: 0
      },
      {
        question: "Choose the correct spelling:",
        section: "Correct Spelling",
        options: ["neighbora", "neighbors", "Neighbour", "neigbours"],
        correctAnswer: 1
      },
      {
        question: "Choose the correct spelling:",
        section: "Correct Spelling",
        options: ["imperative", "impretive", "imperative", "imperaitive"],
        correctAnswer: 0
      },
      // Part-II (Mathematics) (20 Questions) for Q41-Q60
      {
        question: "The value of <strong>$\\sqrt{0.81}$</strong> is...",
        section: "Mathematics",
        options: ["0.9", "0.03", "0.33", "0.94"],
        correctAnswer: 0
      },
      {
        question: "The expression '<strong>A $\\in$ B</strong>' means...",
        section: "Mathematics",
        options: ["A is an element of B", "A is a subset of B", "A and B are disjoint sets", "A is a power set of B"],
        correctAnswer: 0
      },
      {
        question: "The value of <strong>log$_{2}$ 81</strong> is.....",
        section: "Mathematics",
        options: ["1", "4", "6", "9"],
        correctAnswer: 3
      },
      {
        question: "The value of <strong>$\\sqrt{0.9} \\times \\sqrt{1.6}$</strong> is...",
        section: "Mathematics",
        options: ["0.12", "1.2", "0.75", "12"],
        correctAnswer: 1
      },
      {
        question: "The value of <strong>$\\sqrt{4.57/106}$</strong> is approximately...",
        section: "Mathematics",
        options: ["2.1/14", "2.1/15", "2.2/16", "2.9/17"],
        correctAnswer: 1
      },
      {
        question: "The value of <strong>$(1 - \\sin^2 \\theta) + (1 - \\sin^2 \\theta)$</strong> is equal to...",
        section: "Mathematics",
        options: ["$2 \\cos^2 \\theta$", "$2 \\sin^2 \\theta$", "$\\cos^2 \\theta$", "$\\tan^2 \\theta$"],
        correctAnswer: 0
      },
      {
        question: "In the equation <strong>$(3x + 6) = 15$</strong>, the value of x is...",
        section: "Mathematics",
        options: ["1", "2", "3", "4"],
        correctAnswer: 2
      },
      {
        question: "If <strong>$3x = 6x - 15$</strong>, then the value of <strong>$x+8$</strong> is...",
        section: "Mathematics",
        options: ["10", "12", "13", "15"],
        correctAnswer: 2 // x=5, so x+8 = 13. Original answer was 3 (15). Correcting it.
      },
      {
        question: "The fraction equivalent to <strong>0.20%</strong> is...",
        section: "Mathematics",
        options: ["1/500", "1/400", "1/200", "1/40"],
        correctAnswer: 0
      },
      {
        question: "If <strong>$A = \\begin{bmatrix} 1 & 2 \\\\ 5 & 7 \\end{bmatrix}$</strong>, then the element <strong>$a_{21}$</strong> is...",
        section: "Mathematics",
        options: ["1", "2", "5", "7"],
        correctAnswer: 2 // a21 is 5. Original answer was 3 (6). Correcting it.
      },
      {
        question: "If the sales price is <strong>Rs. 672</strong> and the profit is <strong>5%</strong>, then the cost price is...",
        section: "Mathematics",
        options: ["630", "639", "640", "700"],
        correctAnswer: 2
      },
      {
        question: "A trader bought a television for <strong>Rs. 15000</strong>. At what price should he sell to get a profit of <strong>20%</strong>?",
        section: "Mathematics",
        options: ["Rs 16000", "Rs 17000", "Rs 18000", "Rs 20000"],
        correctAnswer: 2
      },
      {
        question: "A fruit seller purchases oranges at a rate of <strong>3 for Rs 5</strong> and sells them at <strong>2 for Rs 4</strong>. His profit percentage is...",
        section: "Mathematics",
        options: ["10%", "20%", "25%", "15%"],
        correctAnswer: 1 // CP = 5/3 = 1.67, SP = 4/2 = 2. Profit = 0.33. Profit % = (0.33/1.67)*100 = 20%. Correcting answer.
      },
      {
        question: "A person sold a stove for <strong>Rs. 470</strong> and incurred a loss of <strong>6%</strong>. At what price should it be sold to earn a profit of <strong>8%</strong>?",
        section: "Mathematics",
        options: ["Rs. 525", "Rs. 500", "Rs. 490", "Rs. 540"],
        correctAnswer: 3
      },
      {
        question: "If <strong>28 men</strong> can finish a work in <strong>15 days</strong>, how many days will <strong>21 men</strong> take to finish the same work?",
        section: "Mathematics",
        options: ["24 days", "14 days", "15 days", "20 days"],
        correctAnswer: 3
      },
      {
        question: "In the first <strong>10 overs</strong> of a cricket match, the run rate was only <strong>3.2</strong>. What should be the run rate in the remaining <strong>40 overs</strong> to reach the target of <strong>282 runs</strong>?",
        section: "Mathematics",
        options: ["6.25", "6.5", "6.75", "7"],
        correctAnswer: 0
      },
      {
        question: "In a class of <strong>80 students</strong>, the ratio of boys to girls is <strong>3:2</strong>. The number of girls in the class is...",
        section: "Mathematics",
        options: ["16", "22", "24", "32"],
        correctAnswer: 3
      },
      {
        question: "On selling a ball at <strong>Rs. 720</strong>, there is a loss of <strong>10%</strong>. The cost price of the ball is...",
        section: "Mathematics",
        options: ["Rs. 750", "Rs. 800", "Rs. 850", "Rs. 900"],
        correctAnswer: 1
      },
      {
        question: "Rauf is <strong>6 feet</strong> tall and he casts a shadow that's <strong>5 feet</strong> long. He then measures that the shadow cast by his school building is <strong>30 feet</strong> long. How tall is the building in feet?",
        section: "Mathematics",
        options: ["28", "32", "36", "40"],
        correctAnswer: 2 // (6/5) = (x/30) => x = 36. Original shadow was 10ft, answer 36. Correcting question text.
      },
      {
        question: "Ages of two persons differ by <strong>16 years</strong>. If <strong>6 years ago</strong>, the elder one was <strong>3 times</strong> as old as the younger one, find their present ages.",
        section: "Mathematics",
        options: ["12, 28", "14, 30", "16, 32", "18, 34"],
        correctAnswer: 1
      },
      // Part-III (General Knowledge) (15 Questions) for Q61-Q75
      {
        question: "The currency of the <strong>United Arab Emirates</strong> is:",
        section: "General Knowledge",
        options: ["Riyal", "Dirham", "Dinar", "Taka"],
        correctAnswer: 1
      },
      {
        question: "The <strong>1973 Constitution of Pakistan</strong> was the country's ......... constitution.",
        section: "General Knowledge",
        options: ["First", "Second", "Third", "Fourth"],
        correctAnswer: 2
      },
      {
        question: "<strong>Gwadar</strong> officially became part of Pakistan in:",
        section: "General Knowledge",
        options: ["1954", "1956", "1958", "1960"],
        correctAnswer: 2
      },
      {
        question: "How many states are there in the <strong>USA</strong>?",
        section: "General Knowledge",
        options: ["50", "51", "52", "53"],
        correctAnswer: 0
      },
      {
        question: "The <strong>Financial Action Task Force (FATF)</strong> was established to stop:",
        section: "General Knowledge",
        options: ["human trafficking", "drug smuggling", "money laundering", "human rights violations"],
        correctAnswer: 2
      },
      {
        question: "<strong>Rohingya Muslims</strong>, one of the world's most persecuted minorities, demand their right to live in:",
        section: "General Knowledge",
        options: ["Thailand", "Singapore", "Afghanistan", "Myanmar"],
        correctAnswer: 3
      },
      {
        question: "The <strong>UN Security Council</strong> has how many non-permanent members?",
        section: "General Knowledge",
        options: ["10", "15", "20", "5"],
        correctAnswer: 0
      },
      {
        question: "The <strong>Belt and Road Initiative (BRI)</strong> was first launched by Chinese president:",
        section: "General Knowledge",
        options: ["Xi Jinping", "Hu Jintao", "Jiang Zemin", "Wen Jiabao"],
        correctAnswer: 0
      },
      {
        question: "The 2022 winner of the Nobel Prize for Literature, <strong>Annie Ernaux</strong>, is from:",
        section: "General Knowledge",
        options: ["USA", "Canada", "Belgium", "France"],
        correctAnswer: 3
      },
      {
        question: "The <strong>first man who travelled in space</strong> was:",
        section: "General Knowledge",
        options: ["Neil Armstrong", "Yuri Gagarin", "Stephen Hawking", "Boris Yeltsin"],
        correctAnswer: 1
      },
      {
        question: "The <strong>Asia Infrastructure Investment Bank (AIIB)</strong> was formed by:",
        section: "General Knowledge",
        options: ["China", "Malaysia", "Indonesia", "Kyrgyzstan"],
        correctAnswer: 0
      },
      {
        question: "<strong>Santiago</strong> is the capital city of:",
        section: "General Knowledge",
        options: ["Chile", "Argentina", "Peru", "Bolivia"],
        correctAnswer: 0 // Original options were wrong. Corrected.
      },
      {
        question: "Pakistan and India joined the <strong>Shanghai Cooperation Organization (SCO)</strong> in:",
        section: "General Knowledge",
        options: ["2017", "2019", "2021", "2022"],
        correctAnswer: 0
      },
      {
        question: "The official languages of the <strong>International Court of Justice (ICJ)</strong> are:",
        section: "General Knowledge",
        options: ["French & Russian", "French & Arabic", "French & Chinese", "French & English"],
        correctAnswer: 3
      },
      {
        question: "Pakistan shares its <strong>longest border</strong> with:",
        section: "General Knowledge",
        options: ["Afghanistan", "China", "India", "Iran"],
        correctAnswer: 0
      },
      // Everyday Science (9 Questions) for Q76-Q84
      {
        question: "Which organ does <strong>NOT</strong> play a primary role in eliminating metabolic waste?",
        section: "Everyday Science",
        options: ["Lungs", "Kidney", "Skin", "Stomach"],
        correctAnswer: 3
      },
      {
        question: "The human kidneys are <strong>______</strong>-shaped.",
        section: "Everyday Science",
        options: ["Bean", "Orange", "Pea", "Carrot"],
        correctAnswer: 0
      },
      {
        question: "The process in which body cells divide for growth and repair is called:",
        section: "Everyday Science",
        options: ["Mitosis", "Meiosis", "Microosis", "Metamorphosis"],
        correctAnswer: 0
      },
      {
        question: "The process of <strong>photosynthesis</strong> produces glucose and:",
        section: "Everyday Science",
        options: ["Carbon dioxide", "Oxygen", "Water", "Carbon monoxide"],
        correctAnswer: 1
      },
      {
        question: "Emission of <strong>chlorofluorocarbons (CFCs)</strong> in the atmosphere destroys the:",
        section: "Everyday Science",
        options: ["Ozone layer", "Oxygen layer", "Air quality", "Clouds"],
        correctAnswer: 0
      },
      {
        question: "The <strong>Law of Conservation of Mass</strong> was given by:",
        section: "Everyday Science",
        options: ["Albert Einstein", "Antoine Lavoisier", "John Dalton", "Henry Cavendish"],
        correctAnswer: 1
      },
      {
        question: "The most common device used to measure <strong>atmospheric pressure</strong> is the:",
        section: "Everyday Science",
        options: ["Barometer", "Thermometer", "Altimeter", "Calorimeter"],
        correctAnswer: 0
      },
      {
        question: "The rapid reaction of a substance with oxygen, releasing heat and light, is called:",
        section: "Everyday Science",
        options: ["Condensation", "Combustion", "Convection", "Conduction"],
        correctAnswer: 1
      },
      {
        question: "What happens when water solidifies into ice (cooling from 4°C to 0°C)?",
        section: "Everyday Science",
        options: ["Its volume increases and density decreases", "Its volume decreases and density increases", "Both volume and density increase", "Both volume and density decrease"],
        correctAnswer: 0
      },
      // Islamiat / Pak Studies (6 Questions) for Q85-Q90
      {
        question: "An instrument used to see <strong>distant objects</strong> is called a:",
        section: "Pakistan Studies",
        options: ["Telescope", "Microscope", "Oscilloscope", "Laparoscope"],
        correctAnswer: 0
      },
      {
        question: "<strong>Sir Syed Ahmed Khan</strong> realized that Muslims were lagging behind due to their conservative approach towards:",
        section: "Pakistan Studies",
        options: ["Eastern and Islamic knowledge", "English and modern knowledge", "Urdu and Islamic knowledge", "English and Urdu knowledge"],
        correctAnswer: 1
      },
      {
        question: "Name the event implemented by the British Raj in <strong>1905</strong>.",
        section: "Pakistan Studies",
        options: ["Simla Deputation", "All India Muslim League", "Partition of Bengal", "Lucknow Pact"],
        correctAnswer: 2
      },
      {
        question: "The minimum number of goats for which <strong>Zakat</strong> is compulsory is:",
        section: "Islamiat",
        options: ["40", "60", "25", "35"],
        correctAnswer: 0
      },
      {
        question: "The founder of <strong>Buddhism</strong> is:",
        section: "Islamiat",
        options: ["Siddhartha Gautama", "Abraham", "Jesus", "Guru Nanak"],
        correctAnswer: 0
      },
      {
        question: "The most common device used to measure <strong>atmospheric pressure</strong> is:",
        section: "General Knowledge",
        options: ["Barometer", "Thermometer", "Altimeter", "Calorimeter"],
        correctAnswer: 0
      },
      // Computer (10 Questions) for Q91-Q100
      {
        question: "In MS Word 2016, pressing the <strong>F8 key three times</strong> will select a:",
        section: "Computer",
        options: ["Word", "Sentence", "Paragraph", "Whole Document"],
        correctAnswer: 1 // F8 x3 selects a sentence.
      },
      {
        question: "In an email mail merge, which of the following represents the main document?",
        section: "Computer",
        options: ["a sales brochure", "a form letter", "a database", "a sheet of names and addresses"],
        correctAnswer: 1
      },
      {
        question: "Which of the following is <strong>not a type of page margin</strong> in MS Word 2016?",
        section: "Computer",
        options: ["Left", "Right", "Center", "Top"],
        correctAnswer: 2
      },
      {
        question: "Which of the following options is <strong>not available</strong> on the <strong>Home Tab</strong> in MS Word?",
        section: "Computer",
        options: ["Columns", "Font Color", "Styles", "Font"],
        correctAnswer: 0
      },
      {
        question: "The minimum number of <strong>rows and columns</strong> in an MS Word 2016 table is:",
        section: "Computer",
        options: ["1 and 1", "2 and 1", "2 and 2", "3 and 3"],
        correctAnswer: 0
      },
      {
        question: "Which function uniquely identifies a cell in MS Excel 2016?",
        section: "Computer",
        options: ["Address", "Name", "Reference", "Range"],
        correctAnswer: 2
      },
      {
        question: "In MS Excel 2016, which chart is most useful for <strong>comparing values across categories</strong>?",
        section: "Computer",
        options: ["Bar Chart", "Column Chart", "Line Chart", "Pie Chart"],
        correctAnswer: 1
      },
      {
        question: "In MS Excel 2016, the most commonly used chart types are:",
        section: "Computer",
        options: ["Pie, Bar, and Surface", "Column, Line, and Pie", "Line, XY, and Bubble", "Doughnut, Stock, and Radar"],
        correctAnswer: 1
      },
      {
        question: "Which of the following is <strong>not a type of network device</strong>?",
        section: "Computer",
        options: ["Switch", "Router", "Gateway", "Protocol"],
        correctAnswer: 3
      },
      {
        question: "Which of the following is <strong>not an example of a web browser</strong>?",
        section: "Computer",
        options: ["Google Chrome", "Safari", "Firefox", "NetBeans"],
        correctAnswer: 3
      }
    ];
        // Global variables for quiz state
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let flaggedQuestions = new Set();
        let timerInterval;
        const totalTime = 60 * 60; // 60 minutes in seconds
        let timeLeft = totalTime;
        const AUTO_SAVE_INTERVAL = 10 * 1000; // Auto-save every 10 seconds

        // DOM Elements
        const passwordScreen = document.getElementById('password-screen');
        const passwordInput = document.getElementById('password-input');
        const togglePassword = document.getElementById('toggle-password');
        const startButton = document.getElementById('start-button');
        const instructionsScreen = document.getElementById('instructions-screen');
        const beginTestButton = document.getElementById('begin-test-button');
        const testScreen = document.getElementById('test-screen');
        const questionSectionDisplay = document.getElementById('question-section'); // New element for section
        const questionContainer = document.getElementById('question-container');
        const optionsContainer = document.getElementById('options-container');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const submitTestButton = document.getElementById('submit-test-button');
        const questionCounter = document.getElementById('question-counter');
        const timerDisplay = document.getElementById('timer');
        const progressBar = document.getElementById('progress-bar');
        const flagButton = document.getElementById('flag-button');
        const questionPalette = document.getElementById('question-palette');
        const resultScreen = document.getElementById('result-screen');
        const finalScoreDisplay = document.getElementById('final-score');
        const totalQuestionsSummary = document.getElementById('total-questions-summary');
        const attemptedQuestionsSummary = document.getElementById('attempted-questions-summary');
        const correctAnswersSummary = document.getElementById('correct-answers-summary');
        const incorrectAnswersSummary = document.getElementById('incorrect-answers-summary');
        const reviewAnswersButton = document.getElementById('review-answers-button');
        const printResultButton = document.getElementById('print-result-button'); // Changed ID
        const retakeTestButton = document.getElementById('retake-test-button');
        const answerReviewContainer = document.getElementById('answer-review-container');
        const confirmSubmitModal = document.getElementById('confirm-submit-modal');
        const confirmSubmitYes = document.getElementById('confirm-submit-yes');
        const confirmSubmitNo = document.getElementById('confirm-submit-no');
        const reviewSummaryModal = document.getElementById('review-summary-modal');
        const summaryAnsweredCount = document.getElementById('summary-answered-count');
        const summaryNotAnsweredCount = document.getElementById('summary-not-answered-count');
        const summaryFlaggedCount = document.getElementById('summary-flagged-count');
        const unansweredFlaggedMessage = document.getElementById('unanswered-flagged-message');
        const summaryContinueTest = document.getElementById('summary-continue-test');
        const summarySubmitTest = document.getElementById('summary-submit-test');
        const loadingOverlay = document.getElementById('loading-overlay');
        const modeToggle = document.getElementById('mode-toggle');
        const toastContainer = document.getElementById('toast-container');


        // Calculator elements
        const calculatorTrigger = document.getElementById('calculator-trigger');
        const calculatorTool = document.getElementById('calculator-tool');
        const calculatorDisplay = document.getElementById('calculator-display');
        const calculatorButtons = document.querySelectorAll('#calculator .button');
        const closeToolButtons = document.querySelectorAll('.close-btn');

        // Scratchpad elements
        const scratchpadTrigger = document.getElementById('scratchpad-trigger');
        const scratchpadTool = document.getElementById('scratchpad-tool');
        const scratchpadTextarea = document.getElementById('scratchpad-textarea');

        // Passage for Q1-Q10 (English Reading Comprehension)
        const readingPassageContainer = document.getElementById('reading-passage-container');
        const readingPassageContent = document.getElementById('reading-passage-content');
        const READING_PASSAGE_TEXT = `
         Worldly desires, glamour, pomp and show and power and peril are all short-lived and subject to decay. Physical beauty but skin deep, worldly power is mutable and transferable, wealth is a temporary asset and many changes then do occur. People seek after things that are uncertain in the sense that they are subject to change. Many stick to their old dwelling places by virtue of changing living conditions and styles of life. However, there are people who are greatly affected by the changing social conditions and move to other places in search of better livelihood. Things keep on changing and some of them leave indelible imprints on the minds of the people.
         Despite constant or recurrent changes, it is a noble character that maintains its integrity and steadfastness for quite some time. The men of upright character enjoy good reputation and real peace of mind. They are held high. During their lifetime they deserve tribute. When they are no more, they deserve homage. Their adherents and friends write eulogies in recognition of their good deeds and brilliant achievements. In this way, they become immortal souls, persons of noble character and living examples of professions and actions. They are the people who enjoy a short sojourn on the earth and eternal life in the Hereafter.
        `;

        /**
         * Displays a toast notification.
         * @param {string} message The message to display.
         * @param {string} type The type of toast (e.g., 'success', 'error', 'info').
         * @param {number} duration The duration in milliseconds before the toast fades out.
         */
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.classList.add('toast', type);
            toast.innerHTML = `<i class="fas ${getToastIcon(type)}"></i> ${message}`;
            toastContainer.appendChild(toast);

            // Remove the toast after the duration + animation time
            setTimeout(() => {
                toast.style.animation = 'toastOut 0.5s forwards';
                toast.addEventListener('animationend', () => {
                    toast.remove();
                });
            }, duration);
        }

        /**
         * Returns the appropriate Font Awesome icon class for a given toast type.
         * @param {string} type The type of toast.
         * @returns {string} The Font Awesome icon class.
         */
        function getToastIcon(type) {
            switch (type) {
                case 'success':
                    return 'fa-check-circle';
                case 'error':
                    return 'fa-times-circle';
                case 'info':
                default:
                    return 'fa-info-circle';
            }
        }


        /**
         * Initializes the quiz state, loading from local storage if available.
         * This function now ensures a fresh start on every load/retake.
         */
        function initializeQuiz() {
            // Always reset to a fresh state on initialization
            resetQuizState();

            renderQuestion();
            updatePalette();
            updateTimerDisplay(); // Initial display of reset time
            updateProgressBar();
            timerDisplay.classList.remove('time-low');
            updateNavigationButtons();
            // Start auto-save for in-session persistence (will be cleared on next full reload)
            startAutoSave();
        }

        /**
         * Resets the quiz state to its initial values and clears local storage.
         */
        function resetQuizState() {
            userAnswers = new Array(quizData.length).fill(null);
            flaggedQuestions = new Set();
            currentQuestionIndex = 0;
            timeLeft = totalTime;
            localStorage.removeItem('quizState'); // Clear saved quiz state
            localStorage.removeItem('scratchpadContent'); // Clear saved scratchpad content
            clearInterval(timerInterval); // Stop any running timer
            stopAutoSave(); // Stop any running auto-save interval
            resetTimerDisplay(); // Reset timer display to its initial value
        }

        /**
         * Saves the current quiz state to local storage.
         */
        function saveQuizState() {
            const stateToSave = {
                currentQuestionIndex: currentQuestionIndex,
                userAnswers: userAnswers,
                flaggedQuestions: Array.from(flaggedQuestions), // Convert Set to Array for JSON
                timeLeft: timeLeft
            };
            localStorage.setItem('quizState', JSON.stringify(stateToSave));
            // console.log('Quiz state saved.'); // For debugging, can be removed
        }

        /**
         * Starts the periodic auto-save.
         */
        function startAutoSave() {
            if (window.autoSaveInterval) {
                clearInterval(window.autoSaveInterval); // Clear any existing interval
            }
            window.autoSaveInterval = setInterval(saveQuizState, AUTO_SAVE_INTERVAL);
        }

        /**
         * Stops the periodic auto-save.
         */
        function stopAutoSave() {
            if (window.autoSaveInterval) {
                clearInterval(window.autoSaveInterval);
                window.autoSaveInterval = null;
            }
        }


        function renderQuestion() {
            const question = quizData[currentQuestionIndex];
            questionSectionDisplay.textContent = `Section: ${question.section}`; // Display section
            // **FIX: Use innerHTML to render bold/underline tags**
            questionContainer.innerHTML = `Q${currentQuestionIndex + 1}: ${question.question}`;
            optionsContainer.innerHTML = ''; // Clear previous options

            // Show/hide reading passage based on question index
            if (currentQuestionIndex >= 0 && currentQuestionIndex <= 9) { // Q1-Q10 for reading comprehension
                readingPassageContainer.classList.remove('hidden');
                readingPassageContent.textContent = READING_PASSAGE_TEXT;
            } else {
                readingPassageContainer.classList.add('hidden');
                readingPassageContent.textContent = '';
            }


            question.options.forEach((optionText, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.classList.add('option');
                optionDiv.textContent = optionText;
                optionDiv.dataset.index = index;
                if (userAnswers[currentQuestionIndex] === index) {
                    optionDiv.classList.add('selected');
                }
                optionDiv.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionDiv);
            });

            questionCounter.textContent = `Question: ${currentQuestionIndex + 1} / ${quizData.length}`;
            updateFlagButton();
            updatePalette();
            updateNavigationButtons(); // Update button visibility after rendering question
        }

        function selectOption(selectedIndex) {
            userAnswers[currentQuestionIndex] = selectedIndex;
            renderQuestion(); // Re-render to show selection
            updatePalette();
            saveQuizState(); // Save state immediately after an answer is selected
        }

        function navigateQuestions(direction) {
            if (direction === 'next' && currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
            } else if (direction === 'prev' && currentQuestionIndex > 0) {
                currentQuestionIndex--;
            }
            renderQuestion();
            saveQuizState(); // Save state after navigation
        }

        function toggleFlag() {
            if (flaggedQuestions.has(currentQuestionIndex)) {
                flaggedQuestions.delete(currentQuestionIndex);
            } else {
                flaggedQuestions.add(currentQuestionIndex);
            }
            updateFlagButton();
            updatePalette();
            saveQuizState(); // Save state after flagging
        }

        function updateFlagButton() {
            if (flaggedQuestions.has(currentQuestionIndex)) {
                flagButton.classList.add('flagged');
                flagButton.innerHTML = '<i class="fas fa-flag"></i> Flagged';
            } else {
                flagButton.classList.remove('flagged');
                flagButton.innerHTML = '<i class="fas fa-flag"></i> Flag for Review';
            }
        }

        function updatePalette() {
            questionPalette.innerHTML = '';
            quizData.forEach((_, index) => {
                const paletteBtn = document.createElement('button');
                paletteBtn.classList.add('palette-btn');
                paletteBtn.textContent = index + 1;
                if (index === currentQuestionIndex) {
                    paletteBtn.classList.add('current');
                }
                if (userAnswers[index] !== null) {
                    paletteBtn.classList.add('answered');
                }
                if (flaggedQuestions.has(index)) {
                    paletteBtn.classList.add('flagged');
                } else if (userAnswers[index] === null) {
                    // This class is not defined, but logic is here if needed
                    // paletteBtn.classList.add('not-answered');
                }
                paletteBtn.addEventListener('click', () => {
                    currentQuestionIndex = index;
                    renderQuestion();
                });
                questionPalette.appendChild(paletteBtn);
            });
        }

        function startTimer() {
            stopAutoSave(); // Stop periodic auto-save when timer interval takes over
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                updateProgressBar();
                saveQuizState(); // Save state with updated time

                if (timeLeft <= 300 && !timerDisplay.classList.contains('time-low')) { // 5 minutes warning
                    timerDisplay.classList.add('time-low');
                    showToast('Less than 5 minutes remaining!', 'warning');
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's Up!";
                    handleSubmitTest(true); // Automatically submit when time runs out
                    showToast('Time is up! Test submitted automatically.', 'info');
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `Time Left: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function resetTimerDisplay() {
            const minutes = Math.floor(totalTime / 60);
            const seconds = totalTime % 60;
            timerDisplay.textContent = `Time Left: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function updateProgressBar() {
            const progress = ((totalTime - timeLeft) / totalTime) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Function to update the visibility of navigation and submit buttons
        function updateNavigationButtons() {
            // Hide 'Previous' button on the first question
            if (currentQuestionIndex === 0) {
                prevButton.classList.add('hidden');
            } else {
                prevButton.classList.remove('hidden');
            }

            // On the last question: hide 'Next' and show 'Submit'
            // Otherwise: show 'Next' and hide 'Submit'
            if (currentQuestionIndex === quizData.length - 1) {
                nextButton.classList.add('hidden');
                submitTestButton.classList.remove('hidden');
            } else {
                nextButton.classList.remove('hidden');
                submitTestButton.classList.add('hidden');
            }
        }


        function calculateResults() {
            let correctCount = 0;
            let attemptedCount = 0;

            userAnswers.forEach((answer, index) => {
                if (answer !== null) {
                    attemptedCount++;
                    if (answer === quizData[index].correctAnswer) {
                        correctCount++;
                    }
                }
            });

            return {
                correct: correctCount,
                attempted: attemptedCount,
                incorrect: attemptedCount - correctCount,
                total: quizData.length
            };
        }

        function showResultScreen(results) {
            testScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            clearInterval(timerInterval); // Stop the timer
            stopAutoSave(); // Stop auto-saving once test is submitted

            finalScoreDisplay.textContent = results.correct;
            totalQuestionsSummary.textContent = results.total;
            attemptedQuestionsSummary.textContent = results.attempted;
            correctAnswersSummary.textContent = results.correct;
            incorrectAnswersSummary.textContent = results.incorrect;

            // Clear quiz state from local storage after submission
            localStorage.removeItem('quizState');
            localStorage.removeItem('scratchpadContent'); // Clear scratchpad too
        }

        function reviewAnswers() {
            answerReviewContainer.innerHTML = '';
            answerReviewContainer.classList.remove('hidden'); // Ensure it's visible

            quizData.forEach((question, index) => {
                const qDiv = document.createElement('div');
                qDiv.classList.add('result-question');

                const qText = document.createElement('p');
                // **FIX: Use innerHTML here as well for the review screen**
                qText.innerHTML = `Q${index + 1}: ${question.question}`;
                qDiv.appendChild(qText);

                question.options.forEach((option, optionIndex) => {
                    const optionP = document.createElement('p');
                    optionP.classList.add('result-option');
                    const optionTextSpan = document.createElement('span');
                    optionTextSpan.textContent = `${String.fromCharCode(65 + optionIndex)}. ${option}`; // A, B, C, D
                    optionP.appendChild(optionTextSpan);

                    if (optionIndex === question.correctAnswer) {
                        optionP.classList.add('correct');
                    }

                    if (userAnswers[index] === optionIndex) {
                        optionP.classList.add('user-answer');
                        if (userAnswers[index] !== question.correctAnswer) {
                            optionP.classList.add('incorrect');
                        }
                    }
                    qDiv.appendChild(optionP);
                });

                if (userAnswers[index] === null) {
                    const notAttemptedP = document.createElement('p');
                    notAttemptedP.classList.add('not-attempted-text');
                    notAttemptedP.textContent = 'Not Attempted';
                    qDiv.appendChild(notAttemptedP);
                }

                answerReviewContainer.appendChild(qDiv);
            });
            reviewAnswersButton.classList.add('hidden'); // Hide review button after showing
            printResultButton.classList.add('hidden'); // Hide print button as well for clarity
            // Scroll to the review section
            answerReviewContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }


        function printResult() {
            // First, ensure the review answers are displayed
            if (answerReviewContainer.classList.contains('hidden')) {
                reviewAnswers();
            }

            // Temporarily hide elements not meant for printing
            const header = document.querySelector('.page-header');
            const footer = document.querySelector('.page-footer');
            const toolTriggers = document.querySelectorAll('.floating-tool-trigger');
            const controls = document.querySelector('#result-screen .controls');

            header.classList.add('hidden');
            footer.classList.add('hidden');
            toolTriggers.forEach(el => el.classList.add('hidden'));
            if (controls) controls.classList.add('hidden');

            // Trigger browser print dialog
            window.print();

            // Restore hidden elements after printing (or print dialog is closed)
            // Use a timeout to allow the print dialog to open and close
            setTimeout(() => {
                header.classList.remove('hidden');
                footer.classList.remove('hidden');
                toolTriggers.forEach(el => el.classList.remove('hidden'));
                if (controls) controls.classList.remove('hidden');
                // Re-hide review answers button if it was hidden before print
                reviewAnswersButton.classList.remove('hidden');
                printResultButton.classList.remove('hidden');
            }, 500); // A small delay to ensure print dialog opens
        }


        // Event Listeners
        startButton.addEventListener('click', () => {
            if (passwordInput.value === PASSWORD) {
                passwordScreen.classList.add('hidden');
                instructionsScreen.classList.remove('hidden');
                showToast('Password correct! Welcome to the test.', 'success');
            } else {
                showToast('Incorrect password. Please try again.', 'error');
                passwordInput.value = '';
            }
        });

        togglePassword.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            togglePassword.querySelector('i').classList.toggle('fa-eye');
            togglePassword.querySelector('i').classList.toggle('fa-eye-slash');
        });


        beginTestButton.addEventListener('click', () => {
            instructionsScreen.classList.add('hidden');
            testScreen.classList.remove('hidden');
            initializeQuiz(); // Call initializeQuiz to set up a fresh test
            startTimer();
            loadScratchpadContent(); // Load saved scratchpad content
            showToast('Test started! Good luck.', 'info');
        });

        prevButton.addEventListener('click', () => navigateQuestions('prev'));
        nextButton.addEventListener('click', () => navigateQuestions('next'));
        flagButton.addEventListener('click', toggleFlag);


        submitTestButton.addEventListener('click', () => {
            const answeredCount = userAnswers.filter(answer => answer !== null).length;
            const notAnsweredCount = quizData.length - answeredCount;
            const flaggedCount = flaggedQuestions.size;

            summaryAnsweredCount.textContent = answeredCount;
            summaryNotAnsweredCount.textContent = notAnsweredCount;
            summaryFlaggedCount.textContent = flaggedCount;

            if (notAnsweredCount > 0 || flaggedCount > 0) {
                let message = "You still have ";
                if (notAnsweredCount > 0) {
                    message += `${notAnsweredCount} unanswered questions`;
                }
                if (notAnsweredCount > 0 && flaggedCount > 0) {
                    message += " and ";
                }
                if (flaggedCount > 0) {
                    message += `${flaggedCount} flagged questions`;
                }
                message += ".";
                unansweredFlaggedMessage.textContent = message;
                reviewSummaryModal.classList.remove('hidden');
            } else {
                confirmSubmitModal.classList.remove('hidden');
            }
        });

        confirmSubmitYes.addEventListener('click', () => handleSubmitTest(false)); // Not time-triggered
        confirmSubmitNo.addEventListener('click', () => confirmSubmitModal.classList.add('hidden'));

        summaryContinueTest.addEventListener('click', () => reviewSummaryModal.classList.add('hidden'));
        summarySubmitTest.addEventListener('click', () => {
            reviewSummaryModal.classList.add('hidden');
            handleSubmitTest(false); // Not time-triggered
        });


        function handleSubmitTest(isTimeUp) {
            confirmSubmitModal.classList.add('hidden'); // Hide modal if open
            reviewSummaryModal.classList.add('hidden'); // Hide review summary modal if open

            const results = calculateResults();
            showResultScreen(results);

            if (isTimeUp) {
                showToast("Time's up! Test submitted automatically.", 'info');
            } else {
                showToast('Test submitted successfully!', 'success');
            }
        }


        reviewAnswersButton.addEventListener('click', reviewAnswers);
        printResultButton.addEventListener('click', printResult); // Changed event listener

        retakeTestButton.addEventListener('click', () => {
            resultScreen.classList.add('hidden');
            passwordScreen.classList.remove('hidden');
            answerReviewContainer.classList.add('hidden'); // Hide review details on retake
            reviewAnswersButton.classList.remove('hidden'); // Show review button again
            printResultButton.classList.remove('hidden'); // Show print button again
            passwordInput.value = ''; // Clear password field
            initializeQuiz(); // Re-initialize all quiz state (will now always be fresh)
            showToast('Test reset. Ready to retake!', 'info');
        });

        // Dark mode toggle
        modeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = modeToggle.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('darkMode', 'enabled');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('darkMode', 'disabled');
            }
        });

        // Apply dark mode preference on load
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            modeToggle.querySelector('i').classList.remove('fa-moon');
            modeToggle.querySelector('i').classList.add('fa-sun');
        } else {
            document.body.classList.remove('dark-mode');
            modeToggle.querySelector('i').classList.remove('fa-sun');
            modeToggle.querySelector('i').classList.add('fa-moon');
        }


        // --- Calculator Logic ---
        const calculator = {
            displayValue: '0',
            firstOperand: null,
            waitingForSecondOperand: false,
            operator: null,
        };

        function updateDisplay() {
            calculatorDisplay.textContent = calculator.displayValue;
        }

        function inputDigit(digit) {
            const { displayValue, waitingForSecondOperand } = calculator;

            if (waitingForSecondOperand === true) {
                calculator.displayValue = digit;
                calculator.waitingForSecondOperand = false;
            } else {
                calculator.displayValue = displayValue === '0' ? digit : displayValue + digit;
            }
            updateDisplay();
        }

        function inputDecimal(dot) {
            if (calculator.waitingForSecondOperand === true) {
                calculator.displayValue = '0.';
                calculator.waitingForSecondOperand = false;
                updateDisplay();
                return;
            }
            if (!calculator.displayValue.includes(dot)) {
                calculator.displayValue += dot;
            }
            updateDisplay();
        }

        function handleOperator(nextOperator) {
            const { firstOperand, displayValue, operator } = calculator;
            const inputValue = parseFloat(displayValue);

            if (operator && calculator.waitingForSecondOperand) {
                calculator.operator = nextOperator;
                return;
            }

            if (firstOperand === null) {
                calculator.firstOperand = inputValue;
            } else if (operator) {
                const result = performCalculation[operator](firstOperand, inputValue);
                if (result === 'Error') {
                    calculator.displayValue = 'Error';
                    calculator.firstOperand = null;
                    calculator.operator = null;
                    calculator.waitingForSecondOperand = false;
                    updateDisplay();
                    return;
                }
                calculator.displayValue = String(parseFloat(result.toFixed(7)));
                calculator.firstOperand = parseFloat(calculator.displayValue);
            }

            calculator.waitingForSecondOperand = true;
            calculator.operator = nextOperator;
            updateDisplay();
        }

        function clearCalculator() {
            calculator.displayValue = '0';
            calculator.firstOperand = null;
            calculator.waitingForSecondOperand = false;
            calculator.operator = null;
            updateDisplay();
        }

        calculatorButtons.forEach(button => {
            button.addEventListener('click', event => {
                const { target } = event;

                if (!target.matches('button')) {
                    return;
                }

                if (target.classList.contains('operator')) {
                    const operatorValue = target.dataset.operator;
                    if (operatorValue === '=') {
                        calculateResultCalc();
                    } else {
                        handleOperator(operatorValue);
                    }
                    return;
                }

                if (target.classList.contains('decimal')) {
                    inputDecimal(target.textContent);
                    return;
                }

                if (target.classList.contains('clear-btn')) {
                    clearCalculator();
                    return;
                }

                if (target.classList.contains('percentage')) {
                    calculator.displayValue = String(parseFloat(calculator.displayValue) / 100);
                    calculator.firstOperand = null;
                    calculator.waitingForSecondOperand = false;
                    updateDisplay();
                    return;
                }

                if (target.classList.contains('plus-minus')) {
                    calculator.displayValue = String(parseFloat(calculator.displayValue) * -1);
                    updateDisplay();
                    return;
                }

                inputDigit(target.textContent);
            });
        });

        const performCalculation = {
            '/': (firstOperand, secondOperand) => secondOperand === 0 ? 'Error' : firstOperand / secondOperand,
            '*': (firstOperand, secondOperand) => firstOperand * secondOperand,
            '+': (firstOperand, secondOperand) => firstOperand + secondOperand,
            '-': (firstOperand, secondOperand) => firstOperand - secondOperand,
        };

        function calculateResultCalc() {
            const inputValue = parseFloat(calculator.displayValue);

            if (calculator.firstOperand === null || calculator.operator === null || calculator.waitingForSecondOperand) {
                return;
            }

            const result = performCalculation[calculator.operator](calculator.firstOperand, inputValue);
            if (result === 'Error') {
                calculator.displayValue = 'Error';
            } else {
                calculator.displayValue = String(parseFloat(result.toFixed(7)));
            }

            calculator.firstOperand = null;
            calculator.operator = null;
            calculator.waitingForSecondOperand = false;
            updateDisplay();
        }

        // --- Scratchpad Logic ---
        function saveScratchpadContent() {
            localStorage.setItem('scratchpadContent', scratchpadTextarea.value);
        }

        function loadScratchpadContent() {
            const savedContent = localStorage.getItem('scratchpadContent');
            if (savedContent) {
                scratchpadTextarea.value = savedContent;
            }
        }

        scratchpadTextarea.addEventListener('input', saveScratchpadContent);
        closeToolButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const toolType = event.currentTarget.dataset.tool;
                if (toolType === 'scratchpad') {
                    saveScratchpadContent();
                    scratchpadTool.classList.add('hidden');
                } else if (toolType === 'calculator') {
                    calculatorTool.classList.add('hidden');
                }
            });
        });


        // --- Floating Tools Draggable Logic ---
        function makeDraggable(element, header) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            header.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        makeDraggable(calculatorTool, calculatorTool.querySelector('.floating-tool-header'));
        makeDraggable(scratchpadTool, scratchpadTool.querySelector('.floating-tool-header'));

        calculatorTrigger.addEventListener('click', () => {
            calculatorTool.classList.toggle('hidden');
            scratchpadTool.classList.add('hidden');
        });

        scratchpadTrigger.addEventListener('click', () => {
            scratchpadTool.classList.toggle('hidden');
            calculatorTool.classList.add('hidden');
        });

        document.addEventListener('DOMContentLoaded', () => {
            // No need to load state here, initializeQuiz handles fresh start
        });

        window.addEventListener('beforeunload', () => {
            if (testScreen.classList.contains('hidden')) return; // Don't save if test is not active
            saveQuizState();
            saveScratchpadContent();
        });

    </script>
</body>
</html>
